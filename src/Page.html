<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        max-width: 600px;
        margin: 50px auto;
        padding: 20px;
        text-align: center;
        background: #f5f5f5;
      }

      .container {
        background: white;
        padding: 40px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }

      h1 {
        color: #333;
        margin-bottom: 10px;
      }

      p {
        color: #666;
        margin-bottom: 30px;
      }

      button {
        background: #4285f4;
        color: white;
        border: none;
        padding: 15px 40px;
        font-size: 16px;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.3s;
      }

      button:hover {
        background: #3367d6;
      }

      button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      .spinner {
        display: none;
        margin: 20px auto;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #4285f4;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      .result {
        display: none;
        margin-top: 30px;
        padding: 20px;
        background: #e8f5e9;
        border-radius: 4px;
        color: #2e7d32;
      }

      .result.error {
        background: #ffebee;
        color: #c62828;
      }

      .result a {
        color: inherit;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Kalkulation erstellen</h1>
      <p>Erstellt ein neues Spreadsheet vom Template und sendet den Link an die API.</p>

      <button id="createBtn" onclick="createSpreadsheet()">
        Spreadsheet erstellen
      </button>

      <div class="spinner" id="spinner"></div>

      <div class="result" id="result"></div>
    </div>

    <script>
      function createSpreadsheet() {
        const button = document.getElementById('createBtn');
        const spinner = document.getElementById('spinner');
        const result = document.getElementById('result');

        // UI anpassen
        button.disabled = true;
        spinner.style.display = 'block';
        result.style.display = 'none';
        result.classList.remove('error');

        // Google Apps Script Funktion aufrufen
        google.script.run
          .withSuccessHandler(function(response) {
            spinner.style.display = 'none';
            button.disabled = false;
            result.style.display = 'block';
            result.innerHTML = `
              <h3>✓ Erfolgreich erstellt!</h3>
              <p>
                <strong>Spreadsheet:</strong><br>
                <a href="${response.url}" target="_blank">${response.url}</a>
              </p>
              <p><strong>API-Status:</strong> ${response.apiStatus}</p>
            `;
          })
          .withFailureHandler(function(error) {
            spinner.style.display = 'none';
            button.disabled = false;
            result.style.display = 'block';
            result.classList.add('error');
            result.innerHTML = `
              <h3>✗ Fehler</h3>
              <p>${error.message}</p>
            `;
          })
          .handleButtonClick();
      }
    </script>
  </body>
</html>
